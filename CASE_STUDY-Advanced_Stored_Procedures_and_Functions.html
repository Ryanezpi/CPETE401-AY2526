<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Study: Advanced Stored Procedures and Functions</title>
</head>
<body style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: #333; background-color: #f8f9fa; margin: 0; padding: 20px;">
    <div style="max-width: 900px; margin: auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">

        <h1 style="font-size: 2.5em; color: #212529; border-bottom: 3px solid #007bff; padding-bottom: 10px; margin-bottom: 30px;">Case Study: Advanced Stored Procedures and Functions</h1>

        <h2 style="font-size: 2em; color: #343a40; margin-top: 40px; margin-bottom: 20px; border-bottom: 1px solid #dee2e6; padding-bottom: 10px;">Objective</h2>
        <p>This case study is designed to challenge your skills in creating and using stored procedures and functions with a more complex database schema. You will be working with a database for a company that manages employees, departments, and projects.</p>

        <h2 style="font-size: 2em; color: #343a40; margin-top: 40px; margin-bottom: 20px; border-bottom: 1px solid #dee2e6; padding-bottom: 10px;">Database Schema</h2>
        <p>The database consists of four tables: <code>employees</code>, <code>departments</code>, <code>projects</code>, and <code>employee_projects</code>.</p>

        <h3 style="font-size: 1.75em; color: #495057; margin-top: 30px; margin-bottom: 15px;"><code>departments</code> table</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <thead style="background-color: #e9ecef;">
                <tr>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Column</th>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Type</th>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>department_id</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">INT</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Primary Key</td>
                </tr>
                <tr style="background-color: #f8f9fa;">
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>department_name</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">VARCHAR(255)</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Name of the department</td>
                </tr>
            </tbody>
        </table>

        <h3 style="font-size: 1.75em; color: #495057; margin-top: 30px; margin-bottom: 15px;"><code>employees</code> table</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <thead style="background-color: #e9ecef;">
                <tr>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Column</th>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Type</th>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>employee_id</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">INT</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Primary Key</td>
                </tr>
                <tr style="background-color: #f8f9fa;">
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>first_name</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">VARCHAR(255)</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">First name of the employee</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>last_name</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">VARCHAR(255)</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Last name of the employee</td>
                </tr>
                <tr style="background-color: #f8f9fa;">
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>salary</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">DECIMAL(10, 2)</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Monthly salary of the employee</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>department_id</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">INT</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Foreign Key to <code>departments</code> table</td>
                </tr>
            </tbody>
        </table>

        <h3 style="font-size: 1.75em; color: #495057; margin-top: 30px; margin-bottom: 15px;"><code>projects</code> table</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <thead style="background-color: #e9ecef;">
                <tr>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Column</th>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Type</th>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>project_id</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">INT</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Primary Key</td>
                </tr>
                <tr style="background-color: #f8f9fa;">
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>project_name</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">VARCHAR(255)</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Name of the project</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>start_date</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">DATE</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Date the project started</td>
                </tr>
                <tr style="background-color: #f8f9fa;">
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>end_date</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">DATE</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Date the project is expected to end</td>
                </tr>
            </tbody>
        </table>

        <h3 style="font-size: 1.75em; color: #495057; margin-top: 30px; margin-bottom: 15px;"><code>employee_projects</code> table</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <thead style="background-color: #e9ecef;">
                <tr>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Column</th>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Type</th>
                    <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>assignment_id</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">INT</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Primary Key</td>
                </tr>
                <tr style="background-color: #f8f9fa;">
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>employee_id</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">INT</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Foreign Key to <code>employees</code> table</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;"><code>project_id</code></td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">INT</td>
                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: left;">Foreign Key to <code>projects</code> table</td>
                </tr>
            </tbody>
        </table>

        <h2 style="font-size: 2em; color: #343a40; margin-top: 40px; margin-bottom: 20px; border-bottom: 1px solid #dee2e6; padding-bottom: 10px;">Database Structure (SQL)</h2>
        <pre style="background-color: #212529; color: #f8f9fa; padding: 20px; border-radius: 5px; overflow-x: auto; font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 0.9em;"><code>-- departments table
CREATE TABLE `departments` (
  `department_id` INT PRIMARY KEY,
  `department_name` VARCHAR(255)
);

-- employees table
CREATE TABLE `employees` (
  `employee_id` INT PRIMARY KEY,
  `first_name` VARCHAR(255),
  `last_name` VARCHAR(255),
  `salary` DECIMAL(10, 2),
  `department_id` INT,
  FOREIGN KEY (`department_id`) REFERENCES `departments`(`department_id`)
);

-- projects table
CREATE TABLE `projects` (
  `project_id` INT PRIMARY KEY,
  `project_name` VARCHAR(255),
  `start_date` DATE,
  `end_date` DATE
);

-- employee_projects table
CREATE TABLE `employee_projects` (
  `assignment_id` INT PRIMARY KEY,
  `employee_id` INT,
  `project_id` INT,
  FOREIGN KEY (`employee_id`) REFERENCES `employees`(`employee_id`),
  FOREIGN KEY (`project_id`) REFERENCES `projects`(`project_id`)
);
</code></pre>

        <h2 style="font-size: 2em; color: #343a40; margin-top: 40px; margin-bottom: 20px; border-bottom: 1px solid #dee2e6; padding-bottom: 10px;">Sample Data</h2>
        <p>Use the following SQL statements to populate your database with some sample data:</p>
        <pre style="background-color: #212529; color: #f8f9fa; padding: 20px; border-radius: 5px; overflow-x: auto; font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 0.9em;"><code>-- Departments
INSERT INTO `departments` (`department_id`, `department_name`) VALUES
(1, 'Human Resources'),
(2, 'Engineering'),
(3, 'Marketing');

-- Employees
INSERT INTO `employees` (`employee_id`, `first_name`, `last_name`, `salary`, `department_id`) VALUES
(1, 'John', 'Doe', 60000.00, 2),
(2, 'Jane', 'Smith', 75000.00, 2),
(3, 'Peter', 'Jones', 50000.00, 3),
(4, 'Mary', 'Williams', 80000.00, 2),
(5, 'David', 'Brown', 45000.00, 1);

-- Projects
INSERT INTO `projects` (`project_id`, `project_name`, `start_date`, `end_date`) VALUES
(1, 'Project Alpha', '2025-01-15', '2025-06-30'),
(2, 'Project Beta', '2025-03-01', '2025-08-31'),
(3, 'Project Gamma', '2025-05-10', '2025-12-31');

-- Employee Projects
INSERT INTO `employee_projects` (`assignment_id`, `employee_id`, `project_id`) VALUES
(1, 1, 1),
(2, 2, 1),
(3, 1, 2),
(4, 3, 2),
(5, 4, 3),
(6, 5, 3);
</code></pre>

        <h2 style="font-size: 2em; color: #343a40; margin-top: 40px; margin-bottom: 20px; border-bottom: 1px solid #dee2e6; padding-bottom: 10px;">Problem Set</h2>

        <h3 style="font-size: 1.75em; color: #495057; margin-top: 30px; margin-bottom: 15px;">Stored Procedures</h3>
        <ol style="padding-left: 20px; margin-bottom: 20px;">
            <li style="margin-bottom: 15px;"><strong><code>get_employees_in_department</code></strong>: A stored procedure that takes a <code>department_name</code> as input and returns a list of all employees (first name and last name) working in that department.</li>
            <li style="margin-bottom: 15px;"><strong><code>get_projects_for_employee</code></strong>: A stored procedure that takes an <code>employee_id</code> as input and returns a list of all projects (project name, start date, and end date) that the employee is assigned to.</li>
            <li style="margin-bottom: 15px;"><strong><code>add_employee_to_project</code></strong>: A stored procedure that takes an <code>employee_id</code> and a <code>project_id</code> as input and assigns an employee to a project.</li>
            <li style="margin-bottom: 15px;"><strong><code>get_department_salary_expense</code></strong>: A stored procedure that takes a <code>department_name</code> as input and returns the total salary expense for that department.</li>
            <li style="margin-bottom: 15px;"><strong><code>get_employees_with_multiple_projects</code></strong>: A stored procedure that returns a list of all employees who are assigned to more than one project.</li>
        </ol>

        <h3 style="font-size: 1.75em; color: #495057; margin-top: 30px; margin-bottom: 15px;">Stored Functions</h3>
        <ol style="padding-left: 20px; margin-bottom: 20px;">
            <li style="margin-bottom: 15px;"><strong><code>get_employee_full_name</code></strong>: A stored function that takes an <code>employee_id</code> as input and returns the full name of the employee (e.g., "John Doe").</li>
            <li style="margin-bottom: 15px;"><strong><code>get_project_duration</code></strong>: A stored function that takes a <code>project_id</code> as input and returns the duration of the project in days.</li>
            <li style="margin-bottom: 15px;"><strong><code>get_total_project_assignments</code></strong>: A stored function that takes a <code>project_id</code> as input and returns the total number of employees assigned to that project.</li>
            <li style="margin-bottom: 15px;"><strong><code>get_department_of_employee</code></strong>: A stored function that takes an <code>employee_id</code> as input and returns the name of the department the employee belongs to.</li>
            <li style="margin-bottom: 15px;"><strong><code>is_employee_on_project</code></strong>: A stored function that takes an <code>employee_id</code> and a <code>project_id</code> as input and returns <code>TRUE</code> if the employee is assigned to the project and <code>FALSE</code> otherwise.</li>
        </ol>

        <h2 style="font-size: 2em; color: #343a40; margin-top: 40px; margin-bottom: 20px; border-bottom: 1px solid #dee2e6; padding-bottom: 10px;">Submission Instructions</h2>
        <ol style="padding-left: 20px; margin-bottom: 20px;">
            <li style="margin-bottom: 10px;">For each problem, create the stored procedure or function in your MySQL client.</li>
            <li style="margin-bottom: 10px;">Test each stored procedure and function to ensure it works correctly.</li>
            <li style="margin-bottom: 10px;">Take a screenshot of your MySQL client showing the created stored procedure/function and a successful execution.</li>
            <li style="margin-bottom: 10px;">Compile all your screenshots into a single PDF document.</li>
            <li style="margin-bottom: 10px;">The sequence would be the following:
                <ol style="padding-left: 20px; margin-top: 10px;">
                    <li style="margin-bottom: 5px;">Question</li>
                    <li style="margin-bottom: 5px;">Screenshot of the stored procedure/function</li>
                    <li style="margin-bottom: 5px;">Result of the successful execution. If it does not provide any results (e.g., deleting a record), query the record to show the change.</li>
                </ol>
            </li>
            <li style="margin-bottom: 10px;">Submit the PDF document to the "Case Study: Advanced Stored Procedures and Functions" assignment on Canvas.</li>
        </ol>

    </div>
</body>
</html>
